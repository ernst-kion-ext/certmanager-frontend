<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Certificate Management</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/certificate-view.css">
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/statistics.css">
  <script src="js/loadCertificates.js"></script>
  <script src="js/column-selector.js"></script>
  <script src="js/certificate-list.js"></script>
  <script src="js/modal.js"></script>
  <script src="js/certificate-stats.js"></script>
</head>

<body>
  <h1>Certificate Manager</h1>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-title">Certificate<br>Management</div>
    <button class="sidebar-btn active" id="certificates-btn">Certificates</button>
    <button class="sidebar-btn" id="statistics-btn">Statistics</button>

    <!-- Inputs -->
    <div>
      <label for="server-select">Choose server:</label>
      <select id="server-select">
        <option value="https://vault.kiongroup.com:8200/">Production</option>
        <option value="https://vault-uat.kiongroup.com:8200/">UAT (Testing)</option>
        <option value="http://localhost:8000/">Localhost</option>
      </select>
    </div>

    <div>
      <label for="api-key-input">API Key:</label>
      <input type="text" id="api-key-input" placeholder="Enter API key for certmanager ui server">
      <label for="certamount-input" class="certamount-label">Max certificates:</label>
      <input type="number" id="certamount-input" min="1" class="certamount-input" placeholder="All">
      <button id="fetch-certificates-btn" onclick="fetchCertificates()">Submit</button>
    </div>

    <!-- Column Selector -->
    <div style="margin-top: 30px;">
      <label style="font-weight:bold;">Table Columns:</label>
      <div id="column-selectors" style="display: flex; flex-direction: column; gap: 4px; margin-top: 8px;">
        <label><input type="checkbox" class="column-checkbox" data-column="Subject" checked> Subject</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Not Valid Before" checked> Not Valid Before</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Not Valid After" checked> Not Valid After</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Days Left" checked> Days Left</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Key Usage" checked> Key Usage</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Issuer" checked> Issuer</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Status" checked> Status</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Fingerprint" checked> Fingerprint</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Signature Hash Algorithm" checked> Signature Hash Algorithm</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key Type" checked> Public Key Type</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key Size" checked> Public Key Size</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Subject Key Identifier" checked> Subject Key Identifier</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key" checked> Public Key</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Signature" checked> Signature</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Engine" checked> Engine</label>
      </div>
    </div>
  </div>

  <!-- Certificate Main View -->
  <div class="main-content" id="certificates-view">
    <h2>Certificate Table</h2>
    <div class="filter-input-container">
      <input type="text" id="filter-input" placeholder="Search all fields">
    </div>
    <table>
      <thead>
        <!-- Careful, the order or columns matters and
             have to correspond to the certificate-list.js -->
        <tr>
          <th>Subject</th>
          <th>Not Valid Before</th>
          <th>Not Valid After</th>
          <th>Days Left</th>
          <th>Key Usage</th>
          <th>Issuer</th>
          <th>Status</th>
          <th>Fingerprint</th>
          <th>Engine</th>
          <th>Signature Hash Algorithm</th>
          <th>Public Key Type</th>
          <th>Public Key Size</th>
          <th>Subject Key Identifier</th>
          <th>Public Key</th>
          <th>Signature</th>
        </tr>
        <tr id="column-search-row"></tr>
      </thead>
      <tbody id="certificates-body"></tbody>
    </table>
  </div>

  <!-- Statistics-View -->
  <div class="main-content" id="statistics-view" style="display:none;">
    <h2>Certificate Statistics</h2>

    <div class="simple-bar-chart" id="simple-bar-chart">
      <span id="total-certificates">0</span>
      <span id="valid-certificates">0</span>
      <span id="revoked-certificates">0</span>
      <span id="expired-certificates">0</span>
    </div>

  </div>

  <!-- Signature Modal -->
  <div id="signature-modal" onclick="closeModalOnOutsideClick(event)">
    <div id="signature-modal-content">
      <button id="signature-modal-close" onclick="hideSignatureModal()">&times;</button>
      <h3>Certificate Signature</h3>
      <pre id="signature-modal-text"></pre>
      <div id="signature-modal-actions">
        <div id="signature-modal-actions-row1">
          <button onclick="showOriginalSignature()">Show Original</button>
          <button onclick="decodeBase64Signature()">Show as Binary</button>
          <button onclick="showSignatureAsHex()">Show as Hex</button>
        </div>
        <button id="signature-modal-copy" onclick="copySignatureToClipboard()">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <!-- Public Key Modal -->
  <div id="publickey-modal" onclick="closePublicKeyModalOnOutsideClick(event)">
    <div id="publickey-modal-content">
      <button id="publickey-modal-close" onclick="hidePublicKeyModal()">&times;</button>
      <h3>Certificate Public Key</h3>
      <pre id="publickey-modal-text"></pre>
      <div id="publickey-modal-actions">
        <button id="publickey-modal-copy" onclick="copyPublicKeyToClipboard()">Copy to Clipboard</button>
      </div>
    </div>
  </div>
</body>

</html>