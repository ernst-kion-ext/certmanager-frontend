<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Certificate Management</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/certificate-view.css">
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/statistics.css">
  <link rel="stylesheet" href="css/pagination.css">
  <script src="js/loadCertificates.js"></script>
  <script src="js/column-selector.js"></script>
  <script src="js/modal.js"></script>
  <script src="js/pagination.js"></script>
  <script src="js/certificate-list.js"></script>
  <script src="js/certificate-stats.js"></script>
</head>

<body>
  <h1>Certificate Manager</h1>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-title">Certificate<br>Management</div>
    <button class="sidebar-btn active" id="certificates-btn">Certificates</button>
    <button class="sidebar-btn" id="statistics-btn">Statistics</button>

    <!-- Inputs -->
    <div>
      <label for="server-select">Choose server:</label>
      <select id="server-select">
        <option value="https://vault.kiongroup.com:8000/certmanager-ui/">Production</option>
        <option value="https://vault-uat.kiongroup.com:8000/certmanager-ui/">UAT (Testing)</option>
        <option value="http://localhost:8000/">Localhost</option>
      </select>
    </div>

    <div>
      <label for="vaulttoken-input">Vault Token:</label>
      <input type="text" id="vaulttoken-input" placeholder="Enter Vault token for certmanager ui server">
      <label for="certamount-input" class="certamount-label">Max certificates:</label>
      <input type="number" id="certamount-input" min="1" class="certamount-input" placeholder="All">
      <button id="fetch-certificates-btn" onclick="fetchCertificates()">Submit</button>
    </div>

    <!-- Column Selector -->
    <div style="margin-top: 30px;">
      <label style="font-weight:bold;">Table Columns:</label>
      <div id="column-selectors" style="display: flex; flex-direction: column; gap: 4px; margin-top: 8px;">
        <label><input type="checkbox" class="column-checkbox" data-column="Subject" checked> Subject</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Not Valid Before" checked> Not Valid Before</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Not Valid After" checked> Not Valid After</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Days Left" checked> Days Left</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Key Usage" checked> Key Usage</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Issuer" checked> Issuer</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Status" checked> Status</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Fingerprint" checked> Fingerprint</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Signature Hash Algorithm" checked> Signature Hash Algorithm</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key Type" checked> Public Key Type</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key Size" checked> Public Key Size</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Subject Key Identifier" checked> Subject Key Identifier</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Public Key" checked> Public Key</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Signature" checked> Signature</label>
        <label><input type="checkbox" class="column-checkbox" data-column="Engine" checked> Engine</label>
      </div>
    </div>
  </div>

  <!-- Certificate Main View -->
  <div class="main-content" id="certificates-view">
    <h2>Certificate Table</h2>
    <div class="filter-input-container">
      <input type="text" id="filter-input" placeholder="Search all fields">
    </div>
    <table>
      <thead>
        <!-- Careful, the order or columns matters and
             have to correspond to the certificate-list.js -->
        <tr>
          <th title="Click to sort" onclick="changeSortOrderForColumn('subject')">Subject</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('notvalidbefore')">Not Valid Before</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('notvalidafter')">Not Valid After</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('daysleft')">Days Left</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('keyUsage')">Key Usage</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('issuer')">Issuer</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('status')">Status</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('fingerprint')">Fingerprint</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('engine')">Engine</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('signaturehashalgorithm')">Signature Hash Algorithm</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('publickey_type')">Public Key Type</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('publickey_size')">Public Key Size</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('subjectKeyIdentifier')">Subject Key Identifier</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('publickey')">Public Key</th>
          <th title="Click to sort" onclick="changeSortOrderForColumn('signature')">Signature</th>
        </tr>
        <tr id="column-search-row">
          <td>
            <input type="text" class="column-search-input" data-colkey="subject" placeholder="Search Subject">
          </td>
          <td>
            <input type="date" class="column-search-input" data-colkey="notvalidbefore">
          </td>
          <td>
            <input type="date" class="column-search-input" data-colkey="notvalidafter">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="daysleft" placeholder="Search Days Left">
          </td>
          <td>
            <button type="button" class="keyusage-filter-btn" onclick="showKeyUsageModal()">Filter...</button>
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="issuer" placeholder="Search Issuer">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="status" placeholder="Search Status">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="fingerprint" placeholder="Search Fingerprint">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="engine" placeholder="Search Engine">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="signaturehashalgorithm" placeholder="Search Signature Hash Algorithm">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="publickey_type" placeholder="Search Public Key Type">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="publickey_size" placeholder="Search Public Key Size">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="subjectKeyIdentifier" placeholder="Search Subject Key Identifier">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="publickey" placeholder="Search Public Key">
          </td>
          <td>
            <input type="text" class="column-search-input" data-colkey="signature" placeholder="Search Signature">
          </td>
        </tr>
      </thead>
      <tbody id="certificates-body"></tbody>
    </table>
    
    <!-- Pagination controls -->
    <div class="pagination-container">
      <div class="pagination-info">
        Showing <span id="showing-start">0</span> to <span id="showing-end">0</span> of <span id="total-entries">0</span> entries
      </div>
      <div class="pagination-controls">
        <button id="first-page-btn" title="First Page">&laquo;</button>
        <button id="prev-page-btn" title="Previous Page">&lsaquo;</button>
        <span class="pagination-text">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
        <button id="next-page-btn" title="Next Page">&rsaquo;</button>
        <button id="last-page-btn" title="Last Page">&raquo;</button>
      </div>
      <div class="entries-per-page">
        <label for="entries-per-page-select">Show</label>
        <select id="entries-per-page-select">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>entries</span>
      </div>
    </div>
  </div>

  <!-- Statistics-View -->
  <div class="main-content" id="statistics-view" style="display:none;">
    <h2>Certificate Statistics</h2>

    <div class="simple-bar-chart" id="simple-bar-chart">
      <span id="total-certificates">0</span>
      <span id="valid-certificates">0</span>
      <span id="revoked-certificates">0</span>
      <span id="expired-certificates">0</span>
    </div>

  </div>

  <!-- Signature Modal -->
  <div id="signature-modal" onclick="closeModalOnOutsideClick(event)">
    <div id="signature-modal-content">
      <button id="signature-modal-close" onclick="hideSignatureModal()">&times;</button>
      <h3>Certificate Signature</h3>
      <pre id="signature-modal-text"></pre>
      <div id="signature-modal-actions">
        <div id="signature-modal-actions-row1">
          <button onclick="showOriginalSignature()">Show Original</button>
          <button onclick="decodeBase64Signature()">Show as Binary</button>
          <button onclick="showSignatureAsHex()">Show as Hex</button>
        </div>
        <button id="signature-modal-copy" onclick="copySignatureToClipboard()">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <!-- Public Key Modal -->
  <div id="publickey-modal" onclick="closePublicKeyModalOnOutsideClick(event)">
    <div id="publickey-modal-content">
      <button id="publickey-modal-close" onclick="hidePublicKeyModal()">&times;</button>
      <h3>Certificate Public Key</h3>
      <pre id="publickey-modal-text"></pre>
      <div id="publickey-modal-actions">
        <button id="publickey-modal-copy" onclick="copyPublicKeyToClipboard()">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <!-- Key Usage Modal -->
  <div id="keyusage-modal" class="custom-modal" onclick="closeKeyUsageModalOnOutsideClick(event)">
    <div class="custom-modal-content">
      <button class="custom-modal-close" id="keyusage-modal-close" onclick="closeKeyUsageModal()">&times;</button>
      <h3>Filter by Key Usage</h3>
      <form id="keyusage-checkboxes-form"></form>
      <div style="margin-top:16px;">
        <button type="button" id="keyusage-modal-apply" class="keyusage-modal-apply" onclick="applyKeyUsageModal()">Apply</button>
        <button type="button" id="keyusage-modal-clear" class="keyusage-modal-clear" onclick="clearKeyUsageModal()">Clear</button>
      </div>
    </div>
  </div>
</body>

</html>